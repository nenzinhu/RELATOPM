<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador Posto 19 - PMRv</title>
    <style>
        :root { --pm-green: #1a472a; --pm-dark: #0d2616; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #f4f7f6; display: flex; justify-content: center; padding: 20px; }
        .container { background: white; width: 100%; max-width: 750px; padding: 30px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        header { text-align: center; margin-bottom: 25px; border-bottom: 3px solid var(--pm-green); padding-bottom: 10px; }
        h1 { color: var(--pm-green); font-size: 22px; margin: 0; }
        .form-section { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .span-2 { grid-column: span 2; }
        .span-3 { grid-column: span 3; }
        label { display: block; font-weight: 600; margin-bottom: 5px; color: #444; font-size: 13px; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 14px; }
        textarea { resize: vertical; min-height: 80px; font-family: inherit; }
        input:focus, select:focus, textarea:focus { border-color: var(--pm-green); outline: none; }
        #relatorio { background: #f9f9f9; border: 1px solid #ddd; padding: 20px; border-radius: 8px; white-space: pre-wrap; font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.4; color: #222; margin-top: 10px; border-left: 5px solid var(--pm-green); }
        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-copy { background-color: var(--pm-green); color: white; }
        .btn-clear { background-color: #e0e0e0; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>COMANDO DE POL√çCIA MILITAR RODOVI√ÅRIA</h1>
        <small>1¬∫ BPMRv / 1¬™ CIA / Posto 19</small>
    </header>

    <div class="form-section">
        <div>
            <label>SADE</label>
            <input type="text" id="sade" placeholder="---" oninput="atualizar()">
        </div>
        <div>
            <label>Viatura</label>
            <input type="text" id="vtr" placeholder="Ex: 222" oninput="atualizar()">
        </div>
        <div>
            <label>Rodovia</label>
            <select id="rodovia" onchange="verificarRodovia()">
                <option value="SC-401">SC-401</option>
                <option value="SC-405">SC-405</option>
                <option value="SC-406">SC-406</option>
                <option value="SC-281">SC-281</option>
                <option value="SC-407">SC-407</option>
                <option value="OUTRA">Outra...</option>
            </select>
        </div>

        <div id="div_cidade">
            <label>Cidade</label>
            <input type="text" id="cidade" value="Florian√≥polis" oninput="atualizar()">
        </div>
        
        <div>
            <label>KM (ex: 33 ou 3.2)</label>
            <input type="text" id="km" placeholder="---" oninput="atualizar()">
        </div>

        <div>
            <label>Sentido</label>
            <select id="sentido" onchange="toggleSentidoManual()">
                <option value="Centro‚ÄìBairro">Centro‚ÄìBairro</option>
                <option value="Bairro‚ÄìCentro">Bairro‚ÄìCentro</option>
                <option value="KM Crescente">KM Crescente</option>
                <option value="KM Decrescente">KM Decrescente</option>
                <option value="MANUAL">Informar manualmente...</option>
            </select>
            <input type="text" id="sentido_manual" class="hidden" placeholder="Descreva o sentido..." oninput="atualizar()" style="margin-top:5px;">
        </div>

        <div class="span-2">
            <label>Tipo de Ocorr√™ncia</label>
            <select id="ocorrencia" onchange="atualizar()">
                <option value="Sinistro de tr√¢nsito com danos materiais">Danos materiais</option>
                <option value="Sinistro de tr√¢nsito com v√≠tima(s)">Com v√≠tima(s)</option>
                <option value="Sinistro de tr√¢nsito com √≥bito">Com √≥bito</option>
            </select>
        </div>
        <div>
            <label>Acionamento</label>
            <select id="conhecimento" onchange="atualizar()">
                <option value="pela Central">Pela Central</option>
                <option value="ap√≥s deparar-se">Deparou-se</option>
                <option value="por usu√°rio da via">Usu√°rio da via</option>
            </select>
        </div>

        <div class="span-3">
            <label>Tipo de Sinistro (Preenche a din√¢mica abaixo)</label>
            <select id="subtipo" onchange="mudarSubtipo()">
                <optgroup label="1. Atropelamento">
                    <option value="1.1">1.1 Atropelamento de Pedestre</option>
                    <option value="1.2">1.2 Atropelamento de Animal</option>
                </optgroup>
                <optgroup label="2. Abalroamento">
                    <option value="2.1">2.1 Abalroamento Longitudinal (Mesmo Sentido)</option>
                    <option value="2.2">2.2 Abalroamento Longitudinal (Sentido Oposto)</option>
                    <option value="2.3">2.3 Abalroamento Transversal</option>
                </optgroup>
                <optgroup label="3. Colis√£o">
                    <option value="3.1">3.1 Colis√£o Frontal</option>
                    <option value="3.2">3.2 Colis√£o Traseira</option>
                    <option value="3.3">3.3 Engavetamento</option>
                </optgroup>
                <optgroup label="4. Choque">
                    <option value="4.1">4.1 Choque em Poste</option>
                    <option value="4.6">4.6 Choque em Defensa</option>
                    <option value="4.9">4.9 Choque em Objeto Fixo</option>
                </optgroup>
                <optgroup label="5. Sa√≠da de Pista">
                    <option value="5.1">5.1 Sa√≠da de Pista Simples</option>
                    <option value="5.3">5.3 Sa√≠da de Pista com Capotamento</option>
                    <option value="5.4">5.4 Sa√≠da de Pista com Tombamento</option>
                </optgroup>
            </select>
        </div>

        <div class="span-3">
            <label>Din√¢mica (Pode editar ou colar aqui)</label>
            <textarea id="dinamica_texto" oninput="atualizar()"></textarea>
        </div>
    </div>

    <div class="output-container">
        <div id="relatorio"></div>
        <div class="btn-group">
            <button class="btn-clear" onclick="window.location.reload()">Limpar</button>
            <button class="btn-copy" onclick="copiar()">üìã Copiar Relat√≥rio</button>
        </div>
    </div>
</div>

<script>
    const dinamicasPadrao = {
        "1.1": "O ve√≠culo V1 transitava pela via quando atropelou um pedestre.",
        "1.2": "O ve√≠culo V1 transitava pela via quando atropelou um animal.",
        "2.1": "Os ve√≠culos transitavam no mesmo sentido quando ocorreu abalroamento longitudinal.",
        "2.2": "Os ve√≠culos transitavam em sentidos opostos quando ocorreu abalroamento longitudinal.",
        "2.3": "O ve√≠culo V1 abalroou transversalmente o ve√≠culo V2.",
        "3.1": "Os ve√≠culos colidiram frontalmente.",
        "3.2": "O ve√≠culo V1 colidiu na traseira do ve√≠culo V2.",
        "3.3": "O ve√≠culo V1 colidiu com outros ve√≠culos, ocasionando engavetamento.",
        "4.1": "O ve√≠culo V1 chocou-se contra um poste.",
        "4.6": "O ve√≠culo V1 chocou-se contra uma defensa.",
        "4.9": "O ve√≠culo V1 chocou-se contra objeto fixo.",
        "5.1": "O ve√≠culo V1 perdeu o controle direcional e saiu da pista.",
        "5.3": "O ve√≠culo V1 perdeu o controle direcional, saiu da pista e capotou.",
        "5.4": "O ve√≠culo V1 perdeu o controle direcional, saiu da pista e tombou."
    };

    function verificarRodovia() {
        const rodovia = document.getElementById('rodovia').value;
        const campoCidade = document.getElementById('cidade');
        
        if (["SC-401", "SC-405", "SC-406"].includes(rodovia)) {
            campoCidade.value = "Florian√≥polis";
            campoCidade.readOnly = true;
            campoCidade.style.backgroundColor = "#e9ecef";
        } else {
            campoCidade.value = "";
            campoCidade.readOnly = false;
            campoCidade.style.backgroundColor = "#ffffff";
        }
        atualizar();
    }

    function formatarKM(val) {
        if (!val) return "---";
        let clean = val.replace(/[^\d.,]/g, '');
        if (clean === "") return "---";
        clean = clean.replace(',', '.');
        let num = parseFloat(clean);
        if (isNaN(num)) return "---";
        return num.toLocaleString('pt-BR', { minimumFractionDigits: 3, maximumFractionDigits: 3 });
    }

    function toggleSentidoManual() {
        const select = document.getElementById('sentido');
        const inputManual = document.getElementById('sentido_manual');
        if (select.value === "MANUAL") {
            inputManual.classList.remove('hidden');
        } else {
            inputManual.classList.add('hidden');
            inputManual.value = "";
        }
        atualizar();
    }

    function mudarSubtipo() {
        const cod = document.getElementById('subtipo').value;
        document.getElementById('dinamica_texto').value = dinamicasPadrao[cod] || "";
        atualizar();
    }

    function atualizar() {
        const sade = document.getElementById('sade').value || "---";
        const vtr = document.getElementById('vtr').value || "---";
        const cidade = document.getElementById('cidade').value || "---";
        const conhecimento = document.getElementById('conhecimento').value;
        const ocorrencia = document.getElementById('ocorrencia').value;
        const rodovia = document.getElementById('rodovia').value;
        const kmRaw = document.getElementById('km').value;
        const kmFormatado = formatarKM(kmRaw);
        
        const tipoLabel = document.getElementById('subtipo').options[document.getElementById('subtipo').selectedIndex].text.split(' ').slice(1).join(' ');
        const dinamicaManual = document.getElementById('dinamica_texto').value;

        const sentidoSelect = document.getElementById('sentido').value;
        const sentidoManual = document.getElementById('sentido_manual').value;
        const sentidoFinal = (sentidoSelect === "MANUAL") ? (sentidoManual || "---") : sentidoSelect;

        const agora = new Date();
        agora.setMinutes(agora.getMinutes() - 20);
        const dataStr = agora.toLocaleDateString('pt-BR');
        const horaStr = agora.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

        const texto = `COMANDO DE POL√çCIA MILITAR RODOVI√ÅRIA
1¬∫ BPMRv / 1¬™ CIA / Posto 19

Protocolo SADE: ${sade}

Tipo de ocorr√™ncia: ${ocorrencia}
Tipo de sinistro: ${tipoLabel}

Data: ${dataStr}
Hora: ${horaStr}
Rodovia: ${rodovia} / KM: ${kmFormatado}
Cidade: ${cidade}

A guarni√ß√£o foi acionada ${conhecimento} para atendimento de sinistro na rodovia ${rodovia}, km ${kmFormatado}, sentido ${sentidoFinal}, sendo empenhada a Viatura PM-${vtr}.

${dinamicaManual}

Foram adotadas as provid√™ncias administrativas cab√≠veis.`;

        document.getElementById('relatorio').innerText = texto;
    }

    function copiar() {
        const texto = document.getElementById('relatorio').innerText;
        navigator.clipboard.writeText(texto).then(() => {
            const btn = document.querySelector('.btn-copy');
            btn.innerText = "‚úÖ Copiado!";
            setTimeout(() => btn.innerText = "üìã Copiar Relat√≥rio", 2000);
        });
    }

    // Inicializa√ß√£o
    verificarRodovia();
    mudarSubtipo(); // Carrega a primeira din√¢mica padr√£o
</script>

</body>
</html>
