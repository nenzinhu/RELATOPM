
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gerador Posto 19 - PMRv</title>
    <style>
        :root { 
            --pm-green: #00A651; 
            --pm-red: #ED1C24;
            --pm-dark: #1a472a; 
            --wa-green: #25D366; 
        }
        
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background-color: #f4f7f6; 
            display: flex; 
            justify-content: center; 
            padding: 10px; 
            margin: 0;
        }

        .container { 
            background: white; 
            width: 100%; 
            max-width: 750px; 
            padding: 15px; 
            border-radius: 12px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            box-sizing: border-box;
        }

        header { 
            text-align: center; 
            margin-bottom: 15px; 
            border-bottom: 3px solid var(--pm-green); 
            padding-bottom: 8px; 
        }

        h1 { color: var(--pm-dark); font-size: 17px; margin: 0; text-transform: uppercase; }
        small { font-size: 11px; color: #666; font-weight: bold; }

        .form-section { 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 8px; 
            margin-bottom: 15px; 
        }

        .row-flex {
            display: flex;
            gap: 8px;
            grid-column: span 3;
        }

        @media (max-width: 600px) {
            .form-section { grid-template-columns: 1fr; }
            .row-flex { flex-wrap: nowrap; grid-column: span 1; }
            .span-3 { grid-column: span 1; }
            button { width: 100%; }
        }

        label { display: block; font-weight: 600; margin-bottom: 4px; color: #444; font-size: 12px; }
        
        input, select, textarea { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid #ccc; 
            border-radius: 6px; 
            box-sizing: border-box; 
            font-size: 14px;
            background-color: #fff;
        }

        textarea { resize: vertical; min-height: 90px; font-family: inherit; }
        
        #relatorio { 
            background: #f9f9f9; 
            border: 1px solid #ddd; 
            padding: 15px; 
            border-radius: 8px; 
            white-space: pre-wrap; 
            word-wrap: break-word; 
            font-family: 'Courier New', monospace; 
            font-size: 13px; 
            line-height: 1.4; 
            color: #222; 
            margin-top: 10px; 
            border-left: 5px solid var(--pm-green); 
        }

        .btn-group { display: flex; gap: 8px; margin-top: 15px; flex-wrap: wrap; }
        
        button { 
            flex: 1; 
            padding: 14px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 14px;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px; 
        }

        .btn-copy { background-color: var(--pm-dark); color: white; }
        .btn-whatsapp { background-color: var(--wa-green); color: white; }
        .btn-clear { background-color: #e0e0e0; color: #333; }

        .hidden { display: none !important; }
        
        .manual-box { background: #f0f4f1; padding: 10px; border-radius: 6px; border: 1px solid #d1d8d4; margin-top: 5px; }
        .v√≠timas-box { background: #fff0f0; padding: 10px; border-radius: 6px; border: 1px solid #ffdada; display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; }

        .radio-group { display: flex; gap: 10px; align-items: center; margin-bottom: 5px; }
        .radio-group label { font-weight: normal; margin-bottom: 0; cursor: pointer; display: flex; align-items: center; gap: 3px; }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>COMANDO DE POL√çCIA MILITAR RODOVI√ÅRIA</h1>
        <small>1¬∫ BPMRv / 1¬™ CIA / Posto 19</small>
    </header>

    <div class="form-section">
        <div class="row-flex">
            <div style="flex-grow: 1;">
                <label>Protocolo SADE</label>
                <input type="text" id="sade" placeholder="N¬∫ SADE" oninput="atualizar()">
            </div>
            <div style="width: 75px;">
                <label>VTR</label>
                <input type="text" id="vtr" placeholder="0000" maxlength="4" oninput="validarVtr(this)">
            </div>
            <div style="width: 85px;">
                <label>Rodovia</label>
                <select id="rodovia" onchange="verificarRodovia()">
                    <option value="SC-401">401</option>
                    <option value="SC-405">405</option>
                    <option value="SC-406">406</option>
                    <option value="SC-281">281</option>
                    <option value="SC-407">407</option>
                </select>
            </div>
        </div>

        <div class="row-flex">
            <div style="flex-grow: 1;">
                <label>Cidade</label>
                <input type="text" id="cidade" value="Florian√≥polis" oninput="atualizar()">
            </div>
            <div style="width: 100px;">
                <label>KM</label>
                <input type="text" id="km" placeholder="0.000" maxlength="6" oninput="atualizar()">
            </div>
        </div>

        <div class="span-3 manual-box">
            <label>Hor√°rio do Sinistro</label>
            <div class="radio-group">
                <label><input type="radio" name="tipo_hora" id="hora_auto" checked onclick="atualizar()"> Auto</label>
                <label><input type="radio" name="tipo_hora" id="hora_manual" onclick="atualizar()"> Manual</label>
                <input type="time" id="input_hora" oninput="atualizar()" style="width: 110px; padding: 4px;">
            </div>
        </div>

        <div class="span-3">
            <label>Tipo de Ocorr√™ncia</label>
            <select id="ocorrencia" onchange="verificarV√≠timas()">
                <option value="Sinistro de tr√¢nsito com danos materiais">Danos materiais</option>
                <option value="Sinistro de tr√¢nsito com v√≠tima(s)">Com v√≠tima(s)</option>
                <option value="Sinistro de tr√¢nsito com √≥bito">Com √≥bito</option>
            </select>
        </div>

        <div id="box-v√≠timas" class="span-3 v√≠timas-box hidden">
            <div><label>Leve</label><input type="number" id="qtd_leve" value="0" min="0" oninput="atualizar()"></div>
            <div><label>Grave</label><input type="number" id="qtd_grave" value="0" min="0" oninput="atualizar()"></div>
            <div><label>Grav√≠ss.</label><input type="number" id="qtd_gravissima" value="0" min="0" oninput="atualizar()"></div>
        </div>

        <div class="span-3">
            <label>Acionamento</label>
            <select id="conhecimento" onchange="atualizar()">
                <option value="pela Central">Pela Central</option>
                <option value="ap√≥s deparar-se">Deparou-se</option>
                <option value="por usu√°rio da via">Usu√°rio da via</option>
            </select>
        </div>

        <div class="span-3">
            <label>Sentido</label>
            <select id="sentido" onchange="toggleSentidoManual()">
                <option value="Centro‚ÄìBairro">Centro‚ÄìBairro</option>
                <option value="Bairro‚ÄìCentro">Bairro‚ÄìCentro</option>
                <option value="KM Crescente">KM Crescente</option>
                <option value="KM Decrescente">KM Decrescente</option>
                <option value="MANUAL">Outro...</option>
            </select>
            <input type="text" id="sentido_manual" class="hidden" placeholder="Descreva o sentido..." oninput="atualizar()" style="margin-top:5px;">
        </div>

        <div class="span-3">
            <label>Tipo de Sinistro</label>
            <select id="subtipo" onchange="mudarSubtipo()">
                <optgroup label="1. Atropelamento">
                    <option value="1.1">1.1 Atropelamento de Pedestre</option>
                    <option value="1.2">1.2 Atropelamento de Animal</option>
                </optgroup>
                <optgroup label="2. Abalroamento">
                    <option value="2.1">2.1 Abalroamento Longitudinal (Mesmo)</option>
                    <option value="2.2">2.2 Abalroamento Longitudinal (Oposto)</option>
                    <option value="2.3">2.3 Abalroamento Transversal</option>
                </optgroup>
                <optgroup label="3. Colis√£o">
                    <option value="3.1">3.1 Colis√£o Frontal</option>
                    <option value="3.2">3.2 Colis√£o Traseira</option>
                    <option value="3.3">3.3 Engavetamento</option>
                </optgroup>
                <optgroup label="4. Choque">
                    <option value="4.1">4.1 Choque em Poste</option>
                    <option value="4.6">4.6 Choque em Defensa</option>
                    <option value="4.9">4.9 Choque em Objeto (especificar)</option>
                </optgroup>
                <optgroup label="5. Sa√≠da de Pista">
                    <option value="5.1">5.1 Sa√≠da de Pista Simples</option>
                    <option value="5.3">5.3 Sa√≠da de Pista com Capotamento</option>
                    <option value="5.4">5.4 Sa√≠da de Pista com Tombamento</option>
                </optgroup>
                <optgroup label="6. Sa√≠da + Choque">
                    <option value="6.1">6.1 Sa√≠da + Choque Poste</option>
                    <option value="6.2">6.2 Sa√≠da + Choque Muro</option>
                    <option value="6.3">6.3 Sa√≠da + Choque Defensa</option>
                    <option value="6.4">6.4 Sa√≠da + Choque Objeto (especificar)</option>
                </optgroup>
                <optgroup label="7. Outros">
                    <option value="7.1">7.1 Outros (especificar)</option>
                </optgroup>
            </select>
            
            <div id="box-objeto" class="manual-box hidden">
                <label>Qual o objeto?</label>
                <input type="text" id="nome_objeto" placeholder="Ex: √°rvore, barranco..." oninput="mudarSubtipo()">
            </div>

            <div id="box-outros" class="manual-box hidden">
                <label>Descreva a natureza do sinistro:</label>
                <input type="text" id="descricao_outros" placeholder="Ex: Inc√™ndio em ve√≠culo, queda de carga..." oninput="mudarSubtipo()">
            </div>
        </div>

        <div class="span-3">
            <label>Din√¢mica do Fato (Auto-edit√°vel)</label>
            <textarea id="dinamica_texto" oninput="atualizar()"></textarea>
        </div>
    </div>

    <div id="relatorio"></div>
    
    <div class="btn-group">
        <button class="btn-clear" onclick="window.location.reload()">Limpar</button>
        <button class="btn-copy" onclick="copiar()">üìã Copiar</button>
        <button class="btn-whatsapp" onclick="enviarWhatsApp()">üì± WhatsApp</button>
    </div>
</div>

<script>
    const dinamicasPadrao = {
        "1.1": "O ve√≠culo V1 transitava pela via quando atropelou um pedestre.",
        "1.2": "O ve√≠culo V1 transitava pela via quando atropelou um animal.",
        "2.1": "Os ve√≠culos transitavam no mesmo sentido quando ocorreu abalroamento longitudinal.",
        "2.2": "Os ve√≠culos transitavam em sentidos opostos quando ocorreu abalroamento longitudinal.",
        "2.3": "O ve√≠culo V1 abalroou transversalmente o ve√≠culo V2.",
        "3.1": "Os ve√≠culos colidiram frontalmente.",
        "3.2": "O ve√≠culo V1 colidiu na traseira do ve√≠culo V2.",
        "3.3": "O ve√≠culo V1 colidiu com outros ve√≠culos, ocasionando engavetamento.",
        "4.1": "O ve√≠culo V1 chocou-se contra um poste.",
        "4.6": "O ve√≠culo V1 chocou-se contra uma defensa.",
        "4.9": "O ve√≠culo V1 chocou-se contra [OBJETO].",
        "5.1": "O ve√≠culo V1 perdeu o controle direcional e saiu da pista.",
        "5.3": "O ve√≠culo V1 perdeu o controle direcional, saiu da pista e capotou.",
        "5.4": "O ve√≠culo V1 perdeu o controle direcional, saiu da pista e tombou.",
        "6.1": "O ve√≠culo V1 saiu da pista e chocou-se contra um poste.",
        "6.2": "O ve√≠culo V1 saiu da pista e chocou-se contra um muro.",
        "6.3": "O ve√≠culo V1 saiu da pista e chocou-se contra uma defensa.",
        "6.4": "O ve√≠culo V1 saiu da pista e chocou-se contra [OBJETO].",
        "7.1": "Ocorr√™ncia registrada como [OUTROS]."
    };

    function validarVtr(input) {
        input.value = input.value.replace(/\D/g, '').substring(0,4);
        atualizar();
    }

    function verificarV√≠timas() {
        document.getElementById('box-v√≠timas').classList.toggle('hidden', document.getElementById('ocorrencia').value !== "Sinistro de tr√¢nsito com v√≠tima(s)");
        atualizar();
    }

    function verificarRodovia() {
        const rodovia = document.getElementById('rodovia').value;
        const campoCidade = document.getElementById('cidade');
        if (["SC-401", "SC-405", "SC-406"].includes(rodovia)) {
            campoCidade.value = "Florian√≥polis";
            campoCidade.readOnly = true;
            campoCidade.style.backgroundColor = "#f0f0f0";
        } else {
            campoCidade.readOnly = false;
            campoCidade.style.backgroundColor = "#fff";
        }
        atualizar();
    }

    function formatarKM(val) {
        if (!val) return "---";
        let clean = val.replace(/[^\d.,]/g, '').replace(',', '.');
        let num = parseFloat(clean);
        return isNaN(num) ? "---" : num.toLocaleString('pt-BR', { minimumFractionDigits: 3 });
    }

    function toggleSentidoManual() {
        document.getElementById('sentido_manual').classList.toggle('hidden', document.getElementById('sentido').value !== "MANUAL");
        atualizar();
    }

    function mudarSubtipo() {
        const cod = document.getElementById('subtipo').value;
        const nomeObjeto = document.getElementById('nome_objeto').value || "objeto fixo";
        const descOutros = document.getElementById('descricao_outros').value || "natureza n√£o especificada";

        // Exibe/Oculta campos extras
        document.getElementById('box-objeto').classList.toggle('hidden', cod !== "4.9" && cod !== "6.4");
        document.getElementById('box-outros').classList.toggle('hidden', cod !== "7.1");

        let texto = dinamicasPadrao[cod] || "";
        
        // Substitui√ß√µes din√¢micas
        if (cod === "4.9" || cod === "6.4") {
            texto = texto.replace("[OBJETO]", nomeObjeto);
        } else if (cod === "7.1") {
            texto = texto.replace("[OUTROS]", descOutros);
        }

        document.getElementById('dinamica_texto').value = texto;
        atualizar();
    }

    function gerarTexto(comNegrito = false) {
        const b = comNegrito ? "*" : "";
        const sade = document.getElementById('sade').value || "---";
        const vtr = document.getElementById('vtr').value || "---";
        const cidade = document.getElementById('cidade').value || "---";
        const conhecimento = document.getElementById('conhecimento').value;
        const ocorrencia = document.getElementById('ocorrencia').value;
        const rodovia = document.getElementById('rodovia').value;
        const km = formatarKM(document.getElementById('km').value);
        const dinamica = document.getElementById('dinamica_texto').value;
        const sentido = document.getElementById('sentido').value === "MANUAL" ? document.getElementById('sentido_manual').value : document.getElementById('sentido').value;
        
        // Trata o label do tipo de sinistro
        const selectSubtipo = document.getElementById('subtipo');
        let tipoLabel = selectSubtipo.options[selectSubtipo.selectedIndex].text.split(' ').slice(1).join(' ');
        if (selectSubtipo.value === "7.1" && document.getElementById('descricao_outros').value) {
            tipoLabel = document.getElementById('descricao_outros').value;
        }

        let infoV = "";
        if (ocorrencia === "Sinistro de tr√¢nsito com v√≠tima(s)") {
            const l = document.getElementById('qtd_leve').value;
            const g = document.getElementById('qtd_grave').value;
            const gs = document.getElementById('qtd_gravissima').value;
            let p = [];
            if (l > 0) p.push(`${l.toString().padStart(2,'0')} leve(s)`);
            if (g > 0) p.push(`${g.toString().padStart(2,'0')} grave(s)`);
            if (gs > 0) p.push(`${gs.toString().padStart(2,'0')} grav√≠ssima(s)`);
            infoV = p.length > 0 ? `\n${b}V√≠timas:${b} ${p.join(', ')}` : `\n${b}V√≠timas:${b} Qtd n√£o informada`;
        }

        const hora = document.getElementById('hora_manual').checked ? document.getElementById('input_hora').value : new Date().toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'});
        const data = new Date().toLocaleDateString('pt-BR');

        return `${b}COMANDO DE POL√çCIA MILITAR RODOVI√ÅRIA${b}
${b}1¬∫ BPMRv / 1¬™ CIA / Posto 19${b}

${b}Protocolo SADE:${b} ${sade}
${b}Data:${b} ${data}
${b}Hora:${b} ${hora}
${b}Rodovia:${b} ${rodovia} / ${b}KM:${b} ${km}
${b}Cidade:${b} ${cidade}

${b}Tipo de ocorr√™ncia:${b} ${ocorrencia}
${b}Tipo de sinistro:${b} ${tipoLabel}${infoV}

A guarni√ß√£o foi acionada ${conhecimento} para atendimento de sinistro na rodovia ${rodovia}, km ${km}, sentido ${sentido || '---'}, sendo empenhada a Viatura PM-${vtr}.

${dinamica}

Foram adotadas as provid√™ncias administrativas cab√≠veis.`;
    }

    function atualizar() { document.getElementById('relatorio').innerText = gerarTexto(false); }
    
    function copiar() {
        navigator.clipboard.writeText(gerarTexto(false)).then(() => {
            const btn = document.querySelector('.btn-copy');
            btn.innerText = "‚úÖ Copiado!";
            setTimeout(() => btn.innerText = "üìã Copiar", 2000);
        });
    }

    function enviarWhatsApp() {
        window.open(`https://wa.me/?text=${encodeURIComponent(gerarTexto(true))}`, '_blank');
    }

    // Inicializa√ß√£o
    verificarRodovia();
    mudarSubtipo();
</script>
</body>
</html>
